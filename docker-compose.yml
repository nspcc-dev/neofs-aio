---

version: "2.4"
services:
  aio:
    image: nspccdev/neofs-aio:${AIO_VERSION}
    container_name: aio
    domainname: neofs
    hostname: aio
    restart: always
    stop_signal: SIGKILL
    env_file:
      - "./http/http.env"
      - "./rest-gw/rest.env"
    volumes:
      - ./vendor/locode_db:/config/locode_db
      - ./vendor/morph_chain.gz:/config/morph_chain.gz
      - ./morph/protocol.privnet.yml:/config/protocol.privnet.yml
      - ./morph/node-wallet.json:/config/node-wallet.json
      - ./morph/node-config.yaml:/config/node-config.yaml
      - ./sn/cli-cfg.yaml:/config/cli-cfg-sn.yaml
      - ./sn/wallet.json:/config/wallet-sn.json
      - ./sn/config.yaml:/config/config-sn.yaml
      - ./http/wallet.json:/config/wallet-http.json
      - ./rest-gw/wallet.json:/config/wallet-rest.json
      - ./ir/cli-cfg.yaml:/config/cli-cfg-ir.yaml
      - ./ir/config.yaml:/config/config-ir.yaml
      - data:/data
    ports:
      - "30333:30333" # RPC
      - "8080:8080"   # NeoFS API RPC
      - "16513:16513" # Control service
      - "8081:8081" # HTTP Gateway endpoint
      - "8090:8090" # REST Gateway endpoint

  nginx_gw:
    image: nginx:stable-alpine
    domainname: neofs
    hostname: nginx_gw
    container_name: nginx_gw
    restart: on-failure
    stop_signal: SIGKILL
    volumes:
      - ./http/nginx.conf:/etc/nginx/nginx.conf
      - cache:/cache
    ports:
      - "8082:8082" # nginx gateway endpoint
    depends_on:
      - aio

volumes:
  data:
  cache:
